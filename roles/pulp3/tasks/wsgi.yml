---
- name: Install gunicorn
  pip:
    name: gunicorn
    state: present
    virtualenv: '{{ pulp_install_dir }}'
    virtualenv_command: '{{ pulp_python_interpreter }} -m venv'
  become: true
  become_user: '{{ pulp_user }}'

- block:

    - name: Install pulp3-wsgi service files
      template:
        src: pulp3-wsgi.service.j2
        dest: /etc/systemd/system/pulp3-wsgi.service
        owner: root
        group: root
        mode: 0644
      become: true
      notify: Restart pulp3-wsgi.service

    - name: Start pulp3-wsgi.service
      systemd:
        name: pulp3-wsgi.service
        state: '{{ pulp_wsgi_state }}'
        enabled: '{{ pulp_wsgi_enabled }}'
        daemon_reload: true
      become: true

  when: pulp_install_wsgi_service
